<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for app/forgettingCurve.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\prettify.css" />
    <link rel="stylesheet" href="..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\index.html">All files</a> / <a href="index.html">app</a> forgettingCurve.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">5.41% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>2/37</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/9</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">5.41% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>2/37</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import {PROFICIENCIES} from './components/proficiencyEnum';
&nbsp;
export const e = 2.7182828
export const criticalRecall = 1 - 1 / e
/* memory strength in decibels -
 https://docs.google.com/spreadsheets/d/15O87qEZU_t69GrePtRHLTKnmqPUeYeDq0zzGIgRljJs/edit#gid=106595709
 */
export function <span class="fstat-no" title="function not covered" >calculateStrength(</span>R, t) {
    const proficiencyAsDecimal = <span class="cstat-no" title="statement not covered" >R / 100</span>
    const logProficiency = <span class="cstat-no" title="statement not covered" >Math.log(proficiencyAsDecimal)</span>
    const ebbinghaus = <span class="cstat-no" title="statement not covered" >-1 * t / logProficiency</span>
    const dbE = <span class="cstat-no" title="statement not covered" >10 * Math.log10(ebbinghaus)</span>
<span class="cstat-no" title="statement not covered" >    return dbE &gt; 0 ? dbE : 0</span>
}
// Se = previous estimated strength
// R = proficiency from 0 to 100
// t equals time since previous interaction
export function <span class="fstat-no" title="function not covered" >calculateSecondsTilCriticalReviewTime(</span>strength) {
<span class="cstat-no" title="statement not covered" >    return calculateTime(strength, criticalRecall)</span>
}
// function measureInitialPreviousInteractionStrength
export function <span class="fstat-no" title="function not covered" >measurePreviousStrength(</span>estimatedPreviousStrength, R, t) {
&nbsp;
    const proficiencyAsDecimal = <span class="cstat-no" title="statement not covered" >R / 100</span>
    const logProficiency = <span class="cstat-no" title="statement not covered" >Math.log(proficiencyAsDecimal)</span>
    const ebbinghaus = <span class="cstat-no" title="statement not covered" >-1 * t / logProficiency</span>
    let measuredPreviousStrength = <span class="cstat-no" title="statement not covered" >10 * Math.log10(ebbinghaus)</span>
<span class="cstat-no" title="statement not covered" >    measuredPreviousStrength = measuredPreviousStrength &gt; 0 ? measuredPreviousStrength : 0</span>
&nbsp;
    /* if proficiency is greater than/equal to 99 or less than/equal to 1,
     we have a wide range of possibilities for measured strength values  */
    // therefore just use the previous estimated value, because we can't really measure the actual value
    /* if proficiency is less than 1, and its been a really long time
    since the user last saw the fact,
    our measure strength formula above can unintentionally think
     the user's strength value was much higher than it possible
      could have been,
      since we are only recording the value as 1% and not the
      actual .01% or whatever it actually is
     */
<span class="cstat-no" title="statement not covered" >    if (doubleLessThanOrEqualTo(R, PROFICIENCIES.ONE) &amp;&amp; measuredPreviousStrength &gt; estimatedPreviousStrength ) {</span>
<span class="cstat-no" title="statement not covered" >        measuredPreviousStrength = estimatedPreviousStrength</span>
    }
&nbsp;
    /* if proficiency is greater than 99,
    and its been a really short time since the user last saw the fact,
     our measure strength formula above can unintentionally think
      the user's strength value was much lower than it possible could have been,
      since we are only recording the value as 99% and not the actually 99.99% or whatever it actually is
      */
<span class="cstat-no" title="statement not covered" >    if (doubleGreaterThanOrEqualTo(R, PROFICIENCIES.FOUR)  &amp;&amp; measuredPreviousStrength &lt; estimatedPreviousStrength ) {</span>
<span class="cstat-no" title="statement not covered" >        measuredPreviousStrength = estimatedPreviousStrength</span>
    }
<span class="cstat-no" title="statement not covered" >    return measuredPreviousStrength</span>
}
&nbsp;
function <span class="fstat-no" title="function not covered" >doubleLessThanOrEqualTo(</span>doubleOne, doubleTwo) {
<span class="cstat-no" title="statement not covered" >    return doubleOne &lt;= (doubleTwo + .01)</span>
}
function <span class="fstat-no" title="function not covered" >doubleGreaterThanOrEqualTo(</span>doubleOne, doubleTwo) {
<span class="cstat-no" title="statement not covered" >    return doubleOne &gt;= (doubleTwo - .01)</span>
}
&nbsp;
// calculate percent change of recall (e.g. proficiency)
// returns as a num in range [0,1]
export function <span class="fstat-no" title="function not covered" >calculateRecall(</span>S, t) {
<span class="cstat-no" title="statement not covered" >    return Math.pow(e, -1 * t / decibelsToEbbinghaus(S))</span>
}
&nbsp;
function <span class="fstat-no" title="function not covered" >decibelsToEbbinghaus(</span>dbE) {
<span class="cstat-no" title="statement not covered" >    return Math.pow(10, dbE / 10)</span>
}
// R input is in [0,1]
export function <span class="fstat-no" title="function not covered" >calculateTime(</span>S, R) {
<span class="cstat-no" title="statement not covered" >    return -1 * decibelsToEbbinghaus(S) * Math.log(R)</span>
}
&nbsp;
// current proficiency in [0, 100]
export function <span class="fstat-no" title="function not covered" >estimateCurrentStrength(</span>
    previousInteractionStrengthDecibels,
    currentProficiency,
    secondsSinceLastInteraction
) {
    let newInteractionStrengthDecibels
    const t = <span class="cstat-no" title="statement not covered" >secondsSinceLastInteraction</span>
<span class="cstat-no" title="statement not covered" >    if (currentProficiency &lt;= PROFICIENCIES.ONE) {</span>
        const t1percent = <span class="cstat-no" title="statement not covered" >calculateTime(previousInteractionStrengthDecibels, currentProficiency / 100)</span>
<span class="cstat-no" title="statement not covered" >        if (t &gt;= t1percent) {</span>
<span class="cstat-no" title="statement not covered" >            newInteractionStrengthDecibels = previousInteractionStrengthDecibels * t1percent / t</span>
        } else {
<span class="cstat-no" title="statement not covered" >            newInteractionStrengthDecibels = previousInteractionStrengthDecibels</span>
        }
    } else {
<span class="cstat-no" title="statement not covered" >        currentProficiency = currentProficiency / 100</span>
        const Bt = <span class="cstat-no" title="statement not covered" >1 - calculateRecall(previousInteractionStrengthDecibels, t)</span>
        const Bp = <span class="cstat-no" title="statement not covered" >(e * currentProficiency - 1) / (e - 1)</span>
        const Bc = <span class="cstat-no" title="statement not covered" >10 * (e - 1)</span>
        const deltaStrength = <span class="cstat-no" title="statement not covered" >Bt * Bp * Bc</span>
<span class="cstat-no" title="statement not covered" >        newInteractionStrengthDecibels = previousInteractionStrengthDecibels + deltaStrength</span>
    }
<span class="cstat-no" title="statement not covered" >    newInteractionStrengthDecibels = newInteractionStrengthDecibels &lt; 10 ? 10 : newInteractionStrengthDecibels</span>
<span class="cstat-no" title="statement not covered" >    return newInteractionStrengthDecibels</span>
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Mon Nov 06 2017 16:38:39 GMT-0800 (Pacific Standard Time)
</div>
</div>
<script src="..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\sorter.js"></script>
</body>
</html>
